# 依赖关系

声明了识别符和依赖项之后，就需要在依赖项之间声明依赖关系。有两种依赖项需要声明依赖关系，类依赖项和工厂函数依赖项。

## 在类依赖项上声明依赖关系

在类依赖项上声明依赖关系，可以用 `Inject` 装饰器：

```ts highlight=3
class MapService {
  constructor(
    @Inject(SatelliteService) private readonly satellite: SatelliteService
  ) {}
}
```

也可以使用 `createIdentifier` 方法创建的标识符：

```ts highlight=7
interface IPlatformService {}

const IPlatformService = createIdentifier<IPlatformService>('platform')

class DialogService {
  constructor(
    @IPlatformService private readonly platformSrc: IPlatformService
  ) {}
}
```

## 在工厂函数依赖项上声明依赖关系

只需要在 `deps` 中列出即可：

```ts highlight=9
const item = [
  I18NNumberTranspiler,
  {
    useFactory: (i18nService: I18NService) => {
      return i18nService.isChinese()
        ? new ChineseNumberTranspiler()
        : new EnglishNumberTranspiler()
    },
    deps: [I18NService],
  },
]
```

## forwardRef

在下面的例子当中 `Person` 先于 `Father` 声明，但是又依赖于 `Father`，这种情况下，你需要使用 `forwardRef` 来封装一次 `Father`，否则 redi 在记录依赖关系时， `Father` 的值会是 `undefined`。如果这种情况确实发生了，redi 会报错。

```ts highlight=5,7
import { Self, SkipSelf } from '@wendellhu/redi'

class Person {
  constructor(
    @Self() @Inject(forwardRef(() => Father)) private readonly father: Father,
    @SkipSelf()
    @Inject(forwardRef(() => Father))
    private readonly grandfather: Father
  ) {}
}

class Man extends Person {}
class Father extends Man {
  changeDiaper(): void {}
}
```
